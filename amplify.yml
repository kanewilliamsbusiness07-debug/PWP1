version: 1
frontend:
  phases:
    preBuild:
      commands:
        - 'echo "Node version:"'
        - 'node --version'
        - 'echo "NPM version:"'
        - 'npm --version'
        - 'echo "Installing dependencies..."'
        - 'npm ci'
        - 'echo "Generating Prisma client..."'
        - 'npx prisma generate'
        - 'echo "Validating environment variables..."'
        - 'node scripts/validate-env.js || echo "Warning: Some environment variables may be missing. Amplify will inject them at runtime."'
    build:
      commands:
        - 'echo "Building Next.js application..."'
        - 'npm run build'
        - 'echo "Build completed successfully"'
    postBuild:
      commands:
        - 'echo "Post-build phase completed"'
        - 'echo "Artifacts directory: .next"'
        - 'ls -la .next 2>/dev/null || echo "Build artifacts directory not found"'
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
      - .prisma/**/*
